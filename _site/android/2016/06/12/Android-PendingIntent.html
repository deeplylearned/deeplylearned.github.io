<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.png">

    <title>Android PendingIntent</title>
    <meta name="description"
          content="Quick note about learning PendingIntent.">

    <link rel="canonical" href="http://deeplylearned.github.io/android/2016/06/12/Android-PendingIntent.html">
    <link rel="alternate" type="application/rss+xml" title="DeeplyLearned" href="http://deeplylearned.github.io/feed.xml">

    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

</head>


    <body>

    <header class="site-header">
    <div class="container">
        <a id="site-header-brand" href="/" title="Sameer Singh">
            <span class="octicon octicon-mark-github"></span> Sameer Singh
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <a href="/"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Home">
                Home
            </a>
            
            <a href="/open-source"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Open-Source">
                Open-Source
            </a>
            
            <a href="/blog"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Blog">
                Blog
            </a>
            
            <a href="/bookmark"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Bookmark">
                Bookmark
            </a>
            
            <a href="/about"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="About">
                About
            </a>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="Android PendingIntent">
    <div class="container">
        <div id="jumbotron-meta-info">
            <h1>Android PendingIntent</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2016/06/12
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        
        <div class="col-md-8 markdown-body">

            <p>Quick note about learning PendingIntent.</p>

<h2 id="pendingintent">PendingIntent</h2>

<p>A <code class="highlighter-rouge">PendingIntent</code> is a token that we give to a foreign application (e.g. NotificationManager, AlarmManager, AppWidgetManager, or other 3rd party applications), which allows the foreign application to use our own application’s permissions to execute a predefined piece of code even if our application’s process is killed.</p>

<p>If we give the foreign application an Intent, and that application sends/broadcasts the Intent you gave, they will execute the Intent with their own permissions. But if we instead give the foreign application a <code class="highlighter-rouge">PendingIntent</code> you created using your own permission, that application will execute the contained Intent using your application’s permission.</p>

<p>For example, I send a <code class="highlighter-rouge">PendingIntent</code> to AlarmManager to give AlarmManager permissions to launch an activity in my own application in 5 mins.</p>

<h2 id="create-a-pendingintent">Create a PendingIntent</h2>

<p>Retrieve a <code class="highlighter-rouge">PendingIntent</code> to start a new Activity(s)/Broadcast/Service:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span>
<span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivities</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">Intent</span><span class="o">[]</span> <span class="n">intents</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span>
<span class="n">PendingIntent</span><span class="o">.</span><span class="na">getBroadcast</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span>
<span class="n">PendingIntent</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span></code></pre></figure>

<h3 id="flags">Flags</h3>

<ul>
  <li><code class="highlighter-rouge">FLAG_CANCEL_CURRENT</code> - If the described PendingIntent already exists, the current one should be canceled before generating a new one.</li>
  <li><code class="highlighter-rouge">FLAG_NO_CREATE</code> - If the described PendingIntent <strong>does not already exist</strong>, then simply return <strong>null</strong> instead of creating it.</li>
  <li><code class="highlighter-rouge">FLAG_ONE_SHOT</code> - PendingIntent can be used only once.</li>
  <li><code class="highlighter-rouge">FLAG_UPDATE_CURRENT</code> - If the described PendingIntent already exists, then keep it but replace its extra data with what is in this new Intent.</li>
  <li><code class="highlighter-rouge">FLAG_IMMUTABLE</code> - PendingIntent should be immutable. It means that the additional intent argument passed to the send methods to fill in unpopulated properties of this intent will be ignored</li>
</ul>

<h3 id="requestcode">RequestCode</h3>

<p>It is a private request code for the sender and quite useful when there are more than one PendingIntents to send (ex. send two notifications in the mean time). It works as ID to distinguish different PendingIntents. If not set different values, the next PendingIntent will override the previous one even if their wrapped intents have different extra values.</p>

<p>For <code class="highlighter-rouge">FLAG_UPDATE_CURRENT</code> and <code class="highlighter-rouge">FLAG_CANCEL_CURRENT</code>, request code will be used here to tell android how to distinguish two PendingIntents.</p>

<h3 id="example">Example</h3>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// Create an explicit intent to wrap</span>
<span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">LoginActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
 
<span class="n">PendingIntent</span> <span class="n">pendingIntent</span> <span class="o">=</span> 
	<span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">intent</span><span class="o">,</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">FLAG_CANCEL_CURRENT</span><span class="o">);</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="c1">// Perform the operation associated with our pendingIntent</span>
    <span class="n">pendingIntent</span><span class="o">.</span><span class="na">send</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">PendingIntent</span><span class="o">.</span><span class="na">CanceledException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>Another example with Notification:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Intent</span> <span class="n">showUnlockIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">AlarmAlertFullScreen</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">showUnlockIntent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">Alarms</span><span class="o">.</span><span class="na">ALARM_INTENT_EXTRA</span><span class="o">,</span> <span class="n">alarm</span><span class="o">);</span>
<span class="n">showUnlockIntent</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span> <span class="o">|</span> <span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NO_USER_ACTION</span><span class="o">);</span>

<span class="n">PendingIntent</span> <span class="n">resultPendingIntent</span> <span class="o">=</span>
	<span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span>
		<span class="n">context</span><span class="o">,</span>
		<span class="n">alarm</span><span class="o">.</span><span class="na">id</span><span class="o">,</span>
		<span class="n">showUnlockIntent</span><span class="o">,</span>
		<span class="n">PendingIntent</span><span class="o">.</span><span class="na">FLAG_UPDATE_CURRENT</span><span class="o">);</span>

<span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">mBuilder</span> <span class="o">=</span>
	<span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="s">"X-Alarm!"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">label</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">resultPendingIntent</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setFullScreenIntent</span><span class="o">(</span><span class="n">resultPendingIntent</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setOngoing</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
		<span class="o">.</span><span class="na">setDefaults</span><span class="o">(</span><span class="n">NotificationCompat</span><span class="o">.</span><span class="na">DEFAULT_LIGHTS</span><span class="o">);</span>

<span class="n">NotificationManager</span> <span class="n">mNotifyMgr</span> <span class="o">=</span> <span class="o">(</span>
	<span class="n">NotificationManager</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>

<span class="c1">// Uses the alarm id to easily identify the correct notification.</span>
<span class="n">mNotifyMgr</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">alarm</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">mBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span></code></pre></figure>

<h2 id="differences-with-intent">Differences with Intent</h2>

<ul>
  <li>Intent is immediate. But PendingIntent can be triggered later or even cancel later.</li>
  <li>Intent is killed when the related Activity is killed. But PendingIntent still keeps alive.</li>
  <li>Intent must run with a Context. But PendingIntent has its own Context.</li>
  <li>Intent runs in the original task. But PendingIntent run in a new task.</li>
</ul>

<h2 id="refs">Refs</h2>

<ul>
  <li><a href="http://stackoverflow.com/questions/2808796/what-is-an-android-pendingintent">What is an Android PendingIntent?</a></li>
  <li><a href="https://developer.android.com/reference/android/app/PendingIntent.html">PendingIntent API Doc</a></li>
</ul>


            <!-- Comments -->
            

        </div>

        <div class="col-md-4">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>

</article>

        </div>

    <footer class="container">

    <div class="site-footer">

        <div class="copyright pull-left">
            <!-- 请不要更改这一行 方便其他人知道模板的来源 谢谢 -->
            <!-- Please keep this line to let others know where this theme comes from. Thank you :D -->
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
        </div>

        <a href="https://github.com/DONGChuan" target="_blank" aria-label="view source code">
            <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
        </a>

        <div class="pull-right">
            <a href="javascript:window.scrollTo(0,0)" >TOP</a>
        </div>

    </div>

    <!-- Third-Party JS -->
    <script type="text/javascript" src="/bower_components/geopattern/js/geopattern.min.js"></script>

    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>

    

    
    <!-- Google Analytics -->
    <div style="display:none">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-72165600-1', 'auto');
            ga('send', 'pageview');

        </script>
    </div>
    

</footer>


    </body>

</html>
